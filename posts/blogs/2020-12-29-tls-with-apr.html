<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="google-site-verification" content="4Y4j9CIooUmnjwIpVMuPbEtO0gQQy1-Q0hymYrw8Yw0"/>
<meta name="description" content="Adding TLS/SSL support with APR Network library and OpenSSL">
<meta name="keywords" content="ssl, apr, mrcp, openssl, tls">
<title>
Adding TLS/SSL support with APR Network library and OpenSSL
</title>
<link rel="stylesheet" href="https://deep110.github.io/assets/css/main.css">
<script>if(localStorage.getItem("theme")==="dark"){document.documentElement.setAttribute("theme","dark")}</script>
</head>
<body>
<header class="site-header">
<div class="wrapper">
<a href="#" id="menu-icon" aria-label="NavDrawer">
<svg viewBox="0 0 18 15">
<path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
<path d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
<path d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
</svg>
</a>
<a class="site-title" href="https://deep110.github.io/">Deepankar</a>
<a href="#" id="dark-theme-icon" class="icon" title="Switch to dark theme" aria-label="Toggle Theme">
<svg viewBox="0 0 512 512">
<path d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705 0 184 82.311 184 184 0 101.705-82.311 184-184 184z"/>
</svg>
</a>
<nav class="site-nav">
<div class="trigger">
<a class="page-link" href="https://deep110.github.io/travel.html">Travel Log</a>
<a class="page-link" href="https://deep110.github.io/archive.html">Archive</a>
<a class="page-link" href="https://deep110.github.io/projects.html">Projects</a>
<a class="page-link" href="https://deep110.github.io/about.html">About</a>
</div>
</nav>
</div>
</header>
<div class="page-content">
<div class="wrapper">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
<header class="post-header">
<h1 class="post-title" itemprop="name headline">Adding TLS/SSL support with APR Network library and OpenSSL</h1>
<p class="post-meta">
<time datetime="2020-12-29 00:00:00 +0000" itemprop="datePublished">
Dec 29, 2020
</time>
| <span class="time">
10
</span>
Minute Read
</p>
</header>
<div class="post-content" itemprop="articleBody">
<p>During my work at <a href="https://vernacular.ai">vernacular.ai</a> I came across a problem in our telephony setup that some of our clients wanted TLS support even if the setup runs on premise without any internet access.</p>
<p><a href="https://github.com/unispeech/unimrcp">Unimrcp</a> uses apr library for MRCP and SIP. APR does not have out of box support for TLS, hence the blog. Instructions on installing APR can be found their <a href="https://apr.apache.org/compiling_unix.html">homepage</a>.</p>
<h3>Creating a simple TCP server</h3>
<p>Let us start with a simple tcp server implemented using <code>apr_network_io</code>.</p>
<ol>
<li>Initialize the apr_pool</li>
</ol>
<pre style="background-color:#fafafa;">
<code><span style="color:#a626a4;">#include </span><span style="color:#50a14f;">&quot;apr.h&quot;
</span><span style="color:#a626a4;">#include </span><span style="color:#50a14f;">&quot;apr_network_io.h&quot;
</span><span style="color:#383a42;">
</span><span style="color:#a626a4;">int </span><span style="color:#4078f2;">main</span><span style="color:#383a42;">() {
</span><span style="color:#383a42;">    apr_pool_t </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">pool;
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    </span><span style="color:#e45649;">apr_initialize</span><span style="color:#383a42;">();
</span><span style="color:#383a42;">    </span><span style="color:#0184bc;">atexit</span><span style="color:#383a42;">(apr_terminate);
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    </span><span style="font-style:italic;color:#a0a1a7;">// create apr pool
</span><span style="color:#383a42;">    </span><span style="color:#e45649;">apr_pool_create</span><span style="color:#383a42;">(</span><span style="color:#a626a4;">&amp;</span><span style="color:#383a42;">pool, </span><span style="color:#986801;">NULL</span><span style="color:#383a42;">);
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">return </span><span style="color:#986801;">0</span><span style="color:#383a42;">;
</span><span style="color:#383a42;">}
</span></code></pre>
<ol start="2">
<li>Create a listening socket on a port.</li>
</ol>
<pre style="background-color:#fafafa;">
<code><span style="color:#383a42;">apr_status_t </span><span style="color:#4078f2;">create_listening_socket</span><span style="color:#383a42;">(apr_pool_t </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">pool, apr_socket_t </span><span style="color:#a626a4;">**</span><span style="color:#383a42;">lskt, </span><span style="color:#a626a4;">int </span><span style="color:#383a42;">port) {
</span><span style="color:#383a42;">    apr_sockaddr_t </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">saddr;
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    </span><span style="font-style:italic;color:#a0a1a7;">// create a tcp socket
</span><span style="color:#383a42;">    apr_status_t rv </span><span style="color:#a626a4;">= </span><span style="color:#e45649;">apr_socket_create</span><span style="color:#383a42;">(lskt, APR_INET, SOCK_STREAM, APR_PROTO_TCP, pool);
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(rv)
</span><span style="color:#383a42;">       </span><span style="color:#a626a4;">return</span><span style="color:#383a42;"> rv;
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    rv </span><span style="color:#a626a4;">= </span><span style="color:#e45649;">apr_sockaddr_info_get</span><span style="color:#383a42;">(</span><span style="color:#a626a4;">&amp;</span><span style="color:#383a42;">saddr, </span><span style="color:#50a14f;">&quot;127.0.0.1&quot;</span><span style="color:#383a42;">, APR_UNSPEC, port, </span><span style="color:#986801;">0</span><span style="color:#383a42;">, pool);
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(rv)
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">return</span><span style="color:#383a42;"> rv;
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    </span><span style="font-style:italic;color:#a0a1a7;">// bind the localhost:&lt;port&gt; to the created listening socket
</span><span style="color:#383a42;">    rv </span><span style="color:#a626a4;">= </span><span style="color:#e45649;">apr_socket_bind</span><span style="color:#383a42;">(</span><span style="color:#a626a4;">*</span><span style="color:#383a42;">lskt, saddr);
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(rv)
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">return</span><span style="color:#383a42;"> rv;
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    </span><span style="font-style:italic;color:#a0a1a7;">// now listen for incoming connections on this socket
</span><span style="color:#383a42;">    rv </span><span style="color:#a626a4;">= </span><span style="color:#e45649;">apr_socket_listen</span><span style="color:#383a42;">(</span><span style="color:#a626a4;">*</span><span style="color:#383a42;">lskt, </span><span style="color:#986801;">5</span><span style="color:#383a42;">);
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(rv)
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">return</span><span style="color:#383a42;"> rv;
</span><span style="color:#383a42;">    
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">return</span><span style="color:#383a42;"> rv;
</span><span style="color:#383a42;">}
</span></code></pre>
<ol start="3">
<li>Now we can implement the part that will handle the incoming connections.</li>
</ol>
<pre style="background-color:#fafafa;">
<code><span style="color:#383a42;">apr_status_t </span><span style="color:#4078f2;">start_server</span><span style="color:#383a42;">(apr_pool_t </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">pool, </span><span style="color:#a626a4;">int </span><span style="color:#383a42;">port) {
</span><span style="color:#383a42;">    apr_status_t rv </span><span style="color:#a626a4;">=</span><span style="color:#383a42;"> APR_SUCCESS;
</span><span style="color:#383a42;">    apr_pool_t </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">subpool;
</span><span style="color:#383a42;">    apr_socket_t </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">lskt;
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    </span><span style="font-style:italic;color:#a0a1a7;">// create listening socket
</span><span style="color:#383a42;">    rv </span><span style="color:#a626a4;">= </span><span style="color:#e45649;">create_listening_socket</span><span style="color:#383a42;">(pool, </span><span style="color:#a626a4;">&amp;</span><span style="color:#383a42;">lskt, port);
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(rv) {
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">return</span><span style="color:#383a42;"> rv;
</span><span style="color:#383a42;">    }
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    </span><span style="color:#0184bc;">printf</span><span style="color:#383a42;">(</span><span style="color:#50a14f;">&quot;running the server on 127.0.0.1:</span><span style="color:#986801;">%d</span><span style="color:#0184bc;">\n</span><span style="color:#50a14f;">&quot;</span><span style="color:#383a42;">, port);
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    </span><span style="color:#e45649;">apr_pool_create</span><span style="color:#383a42;">(</span><span style="color:#a626a4;">&amp;</span><span style="color:#383a42;">subpool, pool);
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">for </span><span style="color:#383a42;">(;;) {
</span><span style="color:#383a42;">        apr_socket_t </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">cskt;
</span><span style="color:#383a42;">        </span><span style="color:#e45649;">apr_pool_clear</span><span style="color:#383a42;">(subpool);
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">        rv </span><span style="color:#a626a4;">= </span><span style="color:#e45649;">apr_socket_accept</span><span style="color:#383a42;">(</span><span style="color:#a626a4;">&amp;</span><span style="color:#383a42;">cskt, lskt, subpool);
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(rv)
</span><span style="color:#383a42;">            </span><span style="color:#a626a4;">return</span><span style="color:#383a42;"> rv;
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">while</span><span style="color:#383a42;">(</span><span style="color:#986801;">1</span><span style="color:#383a42;">) {
</span><span style="color:#383a42;">            apr_size_t len </span><span style="color:#a626a4;">= </span><span style="color:#986801;">1024</span><span style="color:#383a42;">;
</span><span style="color:#383a42;">            </span><span style="color:#a626a4;">char</span><span style="color:#383a42;"> buf[</span><span style="color:#986801;">1024</span><span style="color:#383a42;">] </span><span style="color:#a626a4;">= </span><span style="color:#383a42;">{</span><span style="color:#986801;">0</span><span style="color:#383a42;">};
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">            </span><span style="font-style:italic;color:#a0a1a7;">// receive data from client
</span><span style="color:#383a42;">            rv </span><span style="color:#a626a4;">= </span><span style="color:#e45649;">apr_socket_recv</span><span style="color:#383a42;">(cskt, </span><span style="color:#a626a4;">&amp;</span><span style="color:#383a42;">buf, </span><span style="color:#a626a4;">&amp;</span><span style="color:#383a42;">len);
</span><span style="color:#383a42;">            </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(rv) {
</span><span style="color:#383a42;">                </span><span style="color:#a626a4;">break</span><span style="color:#383a42;">;
</span><span style="color:#383a42;">            }
</span><span style="color:#383a42;">            </span><span style="font-style:italic;color:#a0a1a7;">// echo the same data back
</span><span style="color:#383a42;">            </span><span style="color:#e45649;">apr_socket_send</span><span style="color:#383a42;">(cskt, </span><span style="color:#a626a4;">&amp;</span><span style="color:#383a42;">buf, </span><span style="color:#a626a4;">&amp;</span><span style="color:#383a42;">len);
</span><span style="color:#383a42;">        }
</span><span style="color:#383a42;">        </span><span style="color:#e45649;">apr_socket_close</span><span style="color:#383a42;">(cskt);
</span><span style="color:#383a42;">    }
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">return</span><span style="color:#383a42;"> rv;
</span><span style="color:#383a42;">}
</span></code></pre>
<p>Our server just echoes back whatever data it has read. Now call this function from <code>main</code>.</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#a626a4;">int </span><span style="color:#4078f2;">main</span><span style="color:#383a42;">() {
</span><span style="color:#383a42;">    </span><span style="font-style:italic;color:#a0a1a7;">//  apr pool creation
</span><span style="color:#383a42;">    </span><span style="font-style:italic;color:#a0a1a7;">// ...
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    apr_status_t rv </span><span style="color:#a626a4;">= </span><span style="color:#e45649;">start_server</span><span style="color:#383a42;">(pool, </span><span style="color:#986801;">8000</span><span style="color:#383a42;">);
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(rv) {
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">char</span><span style="color:#383a42;"> buffer[</span><span style="color:#986801;">256</span><span style="color:#383a42;">] </span><span style="color:#a626a4;">= </span><span style="color:#383a42;">{ </span><span style="color:#986801;">0 </span><span style="color:#383a42;">};
</span><span style="color:#383a42;">        </span><span style="color:#0184bc;">printf</span><span style="color:#383a42;">(</span><span style="color:#50a14f;">&quot;error: </span><span style="color:#986801;">%s</span><span style="color:#0184bc;">\n</span><span style="color:#50a14f;">&quot;</span><span style="color:#383a42;">, </span><span style="color:#e45649;">apr_strerror</span><span style="color:#383a42;">(rv, buffer, </span><span style="color:#a626a4;">sizeof</span><span style="color:#383a42;">(buffer)));
</span><span style="color:#383a42;">    }
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">return </span><span style="color:#986801;">0</span><span style="color:#383a42;">;
</span><span style="color:#383a42;">}
</span></code></pre>
<p>You can build the server like this:</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#383a42;"># build the server
</span><span style="color:#383a42;">gcc -I/usr/local/apr/include/apr-1/ -Wl,-rpath,/usr/local/apr/lib -o echoserver echoserver.c -L/usr/local/apr/lib -lapr-1
</span><span style="color:#383a42;">
</span><span style="color:#383a42;"># run the server
</span><span style="color:#383a42;">./echoserver
</span></code></pre>
<h3>Adding TLS to TCP Server</h3>
<p>We will be using <a href="https://github.com/openssl/openssl">OpenSSL</a> library to add TLS support. Let us implement some functions like <code>apr_network_io.c</code> to account for SSL.</p>
<ol>
<li>Add functions for initialize &amp; destroy OpenSSL Context.</li>
</ol>
<pre style="background-color:#fafafa;">
<code><span style="color:#a626a4;">int </span><span style="color:#4078f2;">load_ssl_certificate</span><span style="color:#383a42;">(SSL_CTX</span><span style="color:#a626a4;">* </span><span style="color:#383a42;">ctx, </span><span style="color:#a626a4;">char* </span><span style="color:#383a42;">cert_file, </span><span style="color:#a626a4;">char* </span><span style="color:#383a42;">key_file) {
</span><span style="color:#383a42;">    </span><span style="font-style:italic;color:#a0a1a7;">/* set the local certificate */
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(</span><span style="color:#e45649;">SSL_CTX_use_certificate_file</span><span style="color:#383a42;">(ctx, cert_file, SSL_FILETYPE_PEM) </span><span style="color:#a626a4;">&lt;= </span><span style="color:#986801;">0</span><span style="color:#383a42;">) {
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">return </span><span style="color:#986801;">0</span><span style="color:#383a42;">;
</span><span style="color:#383a42;">    }
</span><span style="color:#383a42;">    </span><span style="font-style:italic;color:#a0a1a7;">/* set the private key */
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(</span><span style="color:#e45649;">SSL_CTX_use_PrivateKey_file</span><span style="color:#383a42;">(ctx, key_file, SSL_FILETYPE_PEM) </span><span style="color:#a626a4;">&lt;= </span><span style="color:#986801;">0 </span><span style="color:#383a42;">) {
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">return </span><span style="color:#986801;">0</span><span style="color:#383a42;">;
</span><span style="color:#383a42;">    }
</span><span style="color:#383a42;">    </span><span style="font-style:italic;color:#a0a1a7;">/* verify private key */
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(</span><span style="color:#a626a4;">!</span><span style="color:#e45649;">SSL_CTX_check_private_key</span><span style="color:#383a42;">(ctx)) {
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">return </span><span style="color:#986801;">0</span><span style="color:#383a42;">;
</span><span style="color:#383a42;">    }
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">return </span><span style="color:#986801;">1</span><span style="color:#383a42;">;
</span><span style="color:#383a42;">}
</span><span style="color:#383a42;">
</span><span style="color:#a626a4;">int </span><span style="color:#4078f2;">apr_tls_server_destroy</span><span style="color:#383a42;">(SSL_CTX </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">ssl_ctx) {
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(ssl_ctx </span><span style="color:#a626a4;">!= </span><span style="color:#986801;">NULL</span><span style="color:#383a42;">) {
</span><span style="color:#383a42;">        </span><span style="color:#e45649;">SSL_CTX_free</span><span style="color:#383a42;">(ssl_ctx);
</span><span style="color:#383a42;">        ssl_ctx </span><span style="color:#a626a4;">= </span><span style="color:#986801;">NULL</span><span style="color:#383a42;">;
</span><span style="color:#383a42;">    }
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">return </span><span style="color:#986801;">1</span><span style="color:#383a42;">;
</span><span style="color:#383a42;">}
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">SSL_CTX</span><span style="color:#a626a4;">* </span><span style="color:#4078f2;">apr_tls_server_init</span><span style="color:#383a42;">(</span><span style="color:#a626a4;">char* </span><span style="color:#383a42;">cert_file_path, </span><span style="color:#a626a4;">char* </span><span style="color:#383a42;">key_file_path) {
</span><span style="color:#383a42;">    SSL_CTX </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">ssl_ctx;
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    </span><span style="color:#e45649;">SSL_library_init</span><span style="color:#383a42;">();
</span><span style="color:#383a42;">    </span><span style="color:#e45649;">SSL_load_error_strings</span><span style="color:#383a42;">();   </span><span style="font-style:italic;color:#a0a1a7;">/* load all error messages */
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    ssl_ctx </span><span style="color:#a626a4;">= </span><span style="color:#e45649;">SSL_CTX_new</span><span style="color:#383a42;">(</span><span style="color:#e45649;">TLSv1_2_server_method</span><span style="color:#383a42;">());   </span><span style="font-style:italic;color:#a0a1a7;">/* create new context from method */
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(ssl_ctx </span><span style="color:#a626a4;">== </span><span style="color:#986801;">NULL</span><span style="color:#383a42;">) {
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">return </span><span style="color:#986801;">NULL</span><span style="color:#383a42;">;
</span><span style="color:#383a42;">    }
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(</span><span style="color:#e45649;">load_ssl_certificate</span><span style="color:#383a42;">(ssl_ctx, cert_file_path, key_file_path) </span><span style="color:#a626a4;">== </span><span style="color:#986801;">0</span><span style="color:#383a42;">) {
</span><span style="color:#383a42;">        </span><span style="color:#e45649;">apr_tls_server_destroy</span><span style="color:#383a42;">(ssl_ctx);
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">return </span><span style="color:#986801;">NULL</span><span style="color:#383a42;">;
</span><span style="color:#383a42;">    }
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">return</span><span style="color:#383a42;"> ssl_ctx;
</span><span style="color:#383a42;">}
</span></code></pre>
<ol start="2">
<li>Add functions for socket accept, read and write wrapping around apr functions.</li>
</ol>
<pre style="background-color:#fafafa;">
<code><span style="color:#383a42;">apr_status_t </span><span style="color:#4078f2;">apr_tls_socket_accept</span><span style="color:#383a42;">(apr_socket_t </span><span style="color:#a626a4;">**</span><span style="color:#383a42;">new_sock, apr_socket_t </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">sock,
</span><span style="color:#383a42;">    SSL_CTX </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">ssl_ctx, SSL </span><span style="color:#a626a4;">**</span><span style="color:#383a42;">ssl_sock, apr_pool_t </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">connection_pool
</span><span style="color:#383a42;">) {
</span><span style="color:#383a42;">    apr_status_t status </span><span style="color:#a626a4;">= </span><span style="color:#e45649;">apr_socket_accept</span><span style="color:#383a42;">(new_sock, sock, connection_pool);
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(status) {
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">return</span><span style="color:#383a42;"> status;
</span><span style="color:#383a42;">    }
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(ssl_ctx </span><span style="color:#a626a4;">!= </span><span style="color:#986801;">NULL</span><span style="color:#383a42;">) {
</span><span style="color:#383a42;">        apr_os_sock_t raw_sock;
</span><span style="color:#383a42;">        status </span><span style="color:#a626a4;">= </span><span style="color:#e45649;">apr_os_sock_get</span><span style="color:#383a42;">(</span><span style="color:#a626a4;">&amp;</span><span style="color:#383a42;">raw_sock, </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">new_sock);
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(status)
</span><span style="color:#383a42;">            </span><span style="color:#a626a4;">return</span><span style="color:#383a42;"> status;
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">        </span><span style="font-style:italic;color:#a0a1a7;">// create new ssl state from ssl context
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">ssl_sock </span><span style="color:#a626a4;">= </span><span style="color:#e45649;">SSL_new</span><span style="color:#383a42;">(ssl_ctx);
</span><span style="color:#383a42;">        </span><span style="color:#e45649;">SSL_set_fd</span><span style="color:#383a42;">(</span><span style="color:#a626a4;">*</span><span style="color:#383a42;">ssl_sock, raw_sock);
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">        </span><span style="font-style:italic;color:#a0a1a7;">// do ssl handshake
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(</span><span style="color:#e45649;">SSL_accept</span><span style="color:#383a42;">(</span><span style="color:#a626a4;">*</span><span style="color:#383a42;">ssl_sock) </span><span style="color:#a626a4;">!= </span><span style="color:#986801;">1</span><span style="color:#383a42;">) {
</span><span style="color:#383a42;">            </span><span style="color:#0184bc;">printf</span><span style="color:#383a42;">(</span><span style="color:#50a14f;">&quot;SSL Handshake failed&quot;</span><span style="color:#383a42;">);
</span><span style="color:#383a42;">            </span><span style="color:#a626a4;">return </span><span style="color:#986801;">1</span><span style="color:#383a42;">;
</span><span style="color:#383a42;">        }
</span><span style="color:#383a42;">    }
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">return</span><span style="color:#383a42;"> status;
</span><span style="color:#383a42;">}
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">apr_status_t </span><span style="color:#4078f2;">apr_tls_socket_recv</span><span style="color:#383a42;">(apr_socket_t </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">sock, SSL </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">ssl_sock, </span><span style="color:#a626a4;">char *</span><span style="color:#383a42;">buf, apr_size_t </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">len) {
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(ssl_sock </span><span style="color:#a626a4;">== </span><span style="color:#986801;">NULL</span><span style="color:#383a42;">) {
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">return </span><span style="color:#e45649;">apr_socket_recv</span><span style="color:#383a42;">(sock, buf, len);
</span><span style="color:#383a42;">    } </span><span style="color:#a626a4;">else </span><span style="color:#383a42;">{
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">int</span><span style="color:#383a42;"> bytes_read </span><span style="color:#a626a4;">= </span><span style="color:#e45649;">SSL_read</span><span style="color:#383a42;">(ssl_sock, buf, </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">len);
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">len </span><span style="color:#a626a4;">= </span><span style="color:#383a42;">(apr_size_t)bytes_read;
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(</span><span style="color:#e45649;">SSL_get_error</span><span style="color:#383a42;">(ssl_sock, bytes_read) </span><span style="color:#a626a4;">&gt; </span><span style="color:#986801;">0</span><span style="color:#383a42;">) {
</span><span style="color:#383a42;">            </span><span style="color:#a626a4;">return </span><span style="color:#986801;">1</span><span style="color:#383a42;">;
</span><span style="color:#383a42;">        }
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">return</span><span style="color:#383a42;"> APR_SUCCESS;
</span><span style="color:#383a42;">    }
</span><span style="color:#383a42;">}
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">apr_status_t </span><span style="color:#4078f2;">apr_tls_socket_send</span><span style="color:#383a42;">(apr_socket_t </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">sock, SSL </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">ssl_sock, </span><span style="color:#a626a4;">const char *</span><span style="color:#383a42;">buf, apr_size_t </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">len) {
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(ssl_sock </span><span style="color:#a626a4;">== </span><span style="color:#986801;">NULL</span><span style="color:#383a42;">) {
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">return </span><span style="color:#e45649;">apr_socket_send</span><span style="color:#383a42;">(sock,buf,len);
</span><span style="color:#383a42;">    } </span><span style="color:#a626a4;">else </span><span style="color:#383a42;">{
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">int</span><span style="color:#383a42;"> bytes_wrote </span><span style="color:#a626a4;">= </span><span style="color:#e45649;">SSL_write</span><span style="color:#383a42;">(ssl_sock, buf, </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">len);
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">len </span><span style="color:#a626a4;">= </span><span style="color:#383a42;">(apr_size_t)bytes_wrote;
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(</span><span style="color:#e45649;">SSL_get_error</span><span style="color:#383a42;">(ssl_sock, bytes_wrote) </span><span style="color:#a626a4;">&gt; </span><span style="color:#986801;">0</span><span style="color:#383a42;">) {
</span><span style="color:#383a42;">            </span><span style="color:#a626a4;">return </span><span style="color:#986801;">1</span><span style="color:#383a42;">;
</span><span style="color:#383a42;">        }
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">return</span><span style="color:#383a42;"> APR_SUCCESS;
</span><span style="color:#383a42;">    }
</span><span style="color:#383a42;">}
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">apr_status_t </span><span style="color:#4078f2;">apr_tls_socket_close</span><span style="color:#383a42;">(apr_socket_t </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">thesocket, SSL </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">ssl_sock) {
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(ssl_sock </span><span style="color:#a626a4;">!= </span><span style="color:#986801;">NULL</span><span style="color:#383a42;">) {
</span><span style="color:#383a42;">        </span><span style="color:#e45649;">SSL_free</span><span style="color:#383a42;">(ssl_sock);
</span><span style="color:#383a42;">    }
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">return </span><span style="color:#e45649;">apr_socket_close</span><span style="color:#383a42;">(thesocket);
</span><span style="color:#383a42;">}
</span></code></pre>
<p>They have the same function signature as <code>apr_socket_accept</code>, <code>apr_socket_recv</code>, <code>apr_socket_send</code> &amp; <code>apr_socket_close</code> except ssl socket is also added. You can think of it like we are wrapping a another socket around apr_socket to handle SSL encryption/decryption.</p>
<ol start="3">
<li>Now we just need to add it to <code>echoserver.c</code> tying everything up.</li>
</ol>
<pre style="background-color:#fafafa;">
<code><span style="color:#a626a4;">#include </span><span style="color:#50a14f;">&quot;apr.h&quot;
</span><span style="color:#a626a4;">#include </span><span style="color:#50a14f;">&quot;apr_network_io.h&quot;
</span><span style="color:#a626a4;">#include </span><span style="color:#50a14f;">&quot;apr_portable.h&quot;
</span><span style="color:#a626a4;">#include </span><span style="color:#50a14f;">&quot;openssl/ssl.h&quot;
</span><span style="color:#a626a4;">#include </span><span style="color:#50a14f;">&quot;openssl/err.h&quot;
</span><span style="color:#a626a4;">#include </span><span style="color:#50a14f;">&lt;stdlib.h&gt;
</span><span style="color:#383a42;">
</span><span style="color:#a626a4;">int </span><span style="color:#4078f2;">main</span><span style="color:#383a42;">() {
</span><span style="color:#383a42;">    </span><span style="font-style:italic;color:#a0a1a7;">//  apr pool creation
</span><span style="color:#383a42;">    </span><span style="font-style:italic;color:#a0a1a7;">// ...
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    </span><span style="font-style:italic;color:#a0a1a7;">// init ssl context
</span><span style="color:#383a42;">    SSL_CTX </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">ssl_ctx </span><span style="color:#a626a4;">= </span><span style="color:#e45649;">apr_tls_server_init</span><span style="color:#383a42;">(</span><span style="color:#50a14f;">&quot;/path/to/certificate.pem&quot;</span><span style="color:#383a42;">, </span><span style="color:#50a14f;">&quot;/path/to/keyfile.pem&quot;</span><span style="color:#383a42;">);
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    apr_status_t rv </span><span style="color:#a626a4;">= </span><span style="color:#e45649;">start_server</span><span style="color:#383a42;">(pool, ssl_context, </span><span style="color:#986801;">8000</span><span style="color:#383a42;">);
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(rv) {
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">char</span><span style="color:#383a42;"> buffer[</span><span style="color:#986801;">256</span><span style="color:#383a42;">] </span><span style="color:#a626a4;">= </span><span style="color:#383a42;">{ </span><span style="color:#986801;">0 </span><span style="color:#383a42;">};
</span><span style="color:#383a42;">        </span><span style="color:#0184bc;">printf</span><span style="color:#383a42;">(</span><span style="color:#50a14f;">&quot;error: </span><span style="color:#986801;">%s</span><span style="color:#0184bc;">\n</span><span style="color:#50a14f;">&quot;</span><span style="color:#383a42;">, </span><span style="color:#e45649;">apr_strerror</span><span style="color:#383a42;">(rv, buffer, </span><span style="color:#a626a4;">sizeof</span><span style="color:#383a42;">(buffer)));
</span><span style="color:#383a42;">    }
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    </span><span style="font-style:italic;color:#a0a1a7;">// destroy ssl context
</span><span style="color:#383a42;">    </span><span style="color:#e45649;">apr_tls_destroy</span><span style="color:#383a42;">(ssl_ctx);
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">return </span><span style="color:#986801;">0</span><span style="color:#383a42;">;
</span><span style="color:#383a42;">}
</span></code></pre>
<p>Now we will implement <code>start_server</code> function with ssl. Just replace apr functions with corresponding <code>apr_tls_*</code> functions.</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#383a42;">apr_status_t </span><span style="color:#4078f2;">start_server</span><span style="color:#383a42;">(apr_pool_t </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">pool, SSL_CTX </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">ssl_ctx, </span><span style="color:#a626a4;">int </span><span style="color:#383a42;">port) {
</span><span style="color:#383a42;">    apr_status_t rv </span><span style="color:#a626a4;">=</span><span style="color:#383a42;"> APR_SUCCESS;
</span><span style="color:#383a42;">    apr_pool_t </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">subpool;
</span><span style="color:#383a42;">    apr_socket_t </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">lskt;
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    </span><span style="font-style:italic;color:#a0a1a7;">// creation of listening socket will remain same
</span><span style="color:#383a42;">    rv </span><span style="color:#a626a4;">= </span><span style="color:#e45649;">create_listening_socket</span><span style="color:#383a42;">(pool, </span><span style="color:#a626a4;">&amp;</span><span style="color:#383a42;">lskt, port);
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(rv) {
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">return</span><span style="color:#383a42;"> rv;
</span><span style="color:#383a42;">    }
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    </span><span style="color:#0184bc;">printf</span><span style="color:#383a42;">(</span><span style="color:#50a14f;">&quot;running the TLS server on 127.0.0.1:</span><span style="color:#986801;">%d</span><span style="color:#0184bc;">\n</span><span style="color:#50a14f;">&quot;</span><span style="color:#383a42;">, port);
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    </span><span style="color:#e45649;">apr_pool_create</span><span style="color:#383a42;">(</span><span style="color:#a626a4;">&amp;</span><span style="color:#383a42;">subpool, pool);
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">for </span><span style="color:#383a42;">(;;) {
</span><span style="color:#383a42;">        apr_socket_t </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">cskt;
</span><span style="color:#383a42;">        SSL </span><span style="color:#a626a4;">*</span><span style="color:#383a42;">ssl_socket;
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">        </span><span style="color:#e45649;">apr_pool_clear</span><span style="color:#383a42;">(subpool);
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">        </span><span style="font-style:italic;color:#a0a1a7;">// connect to an incoming socket connection
</span><span style="color:#383a42;">        rv </span><span style="color:#a626a4;">= </span><span style="color:#e45649;">apr_tls_socket_accept</span><span style="color:#383a42;">(</span><span style="color:#a626a4;">&amp;</span><span style="color:#383a42;">cskt, lskt, ssl_ctx, </span><span style="color:#a626a4;">&amp;</span><span style="color:#383a42;">ssl_socket, subpool);
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(rv)
</span><span style="color:#383a42;">            </span><span style="color:#a626a4;">return</span><span style="color:#383a42;"> rv;
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">        </span><span style="color:#a626a4;">while</span><span style="color:#383a42;">(</span><span style="color:#986801;">1</span><span style="color:#383a42;">) {
</span><span style="color:#383a42;">            apr_size_t len </span><span style="color:#a626a4;">= </span><span style="color:#986801;">1024</span><span style="color:#383a42;">;
</span><span style="color:#383a42;">            </span><span style="color:#a626a4;">char</span><span style="color:#383a42;"> buf[</span><span style="color:#986801;">1024</span><span style="color:#383a42;">] </span><span style="color:#a626a4;">= </span><span style="color:#383a42;">{</span><span style="color:#986801;">0</span><span style="color:#383a42;">};
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">            rv </span><span style="color:#a626a4;">= </span><span style="color:#e45649;">apr_tls_socket_recv</span><span style="color:#383a42;">(cskt, ssl_socket, </span><span style="color:#a626a4;">&amp;</span><span style="color:#383a42;">buf, </span><span style="color:#a626a4;">&amp;</span><span style="color:#383a42;">len); </span><span style="font-style:italic;color:#a0a1a7;">// read data
</span><span style="color:#383a42;">            </span><span style="color:#a626a4;">if </span><span style="color:#383a42;">(rv) {
</span><span style="color:#383a42;">                </span><span style="color:#a626a4;">break</span><span style="color:#383a42;">;
</span><span style="color:#383a42;">            }
</span><span style="color:#383a42;">            rv </span><span style="color:#a626a4;">= </span><span style="color:#e45649;">apr_tls_socket_send</span><span style="color:#383a42;">(cskt, ssl_socket, </span><span style="color:#a626a4;">&amp;</span><span style="color:#383a42;">buf, </span><span style="color:#a626a4;">&amp;</span><span style="color:#383a42;">len); </span><span style="font-style:italic;color:#a0a1a7;">// write same data back
</span><span style="color:#383a42;">            </span><span style="color:#a626a4;">break</span><span style="color:#383a42;">;
</span><span style="color:#383a42;">        }
</span><span style="color:#383a42;">        </span><span style="color:#e45649;">apr_tls_socket_close</span><span style="color:#383a42;">(cskt, ssl_socket);
</span><span style="color:#383a42;">    }
</span><span style="color:#383a42;">
</span><span style="color:#383a42;">    </span><span style="color:#a626a4;">return</span><span style="color:#383a42;"> rv;
</span><span style="color:#383a42;">}
</span></code></pre>
<h3>Building and Testing the Server</h3>
<p>You can build the server like this [Take care to include libssl &amp; libcrypto]: </p>
<pre style="background-color:#fafafa;">
<code><span style="color:#e45649;">gcc</span><span style="color:#383a42;"> -I/usr/local/apr/include/apr-1/ -Wl,-rpath,/usr/local/apr/lib -o echoserver echoserver.c -L/usr/local/apr/lib -lapr-1 -lssl -lcrypto
</span></code></pre>
<p>To test the server use openssl client</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#e45649;">openssl</span><span style="color:#383a42;"> s_client -connect localhost:8000
</span></code></pre>
<p>You can also find the full code <a href="https://gist.github.com/deep110/a7e5fbc31dea6989907d3dc595efdc4e">here</a>.
Hope this helps people to start with openssl and APR library and how they can be used to build a fully functional TCP server with TLS support.</p>
</div>
<form id="subscribe-form" action="https://tinyletter.com/deep110" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/deep110', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
<label for="tlemail">
<h2>Get new blogs sent to you</h2>
</label>
<span id="tl-email-describe">
Subscribe to my blog on programming, computer graphics, and few other topics. Published once a month.
</span>
<div style="margin-top: 8px;">
<input type="text" name="email" placeholder="Your email address" id="tlemail"/>
<input type="hidden" value="1" name="embed"/>
<button type="submit" name="subscribe" id="btn-subscribe">Subscribe</button>
</div>
</form>
<div class="post-navigation">
<a href="https://deep110.github.io/posts/blogs/2020-03-04-grcp-auth.html">←&nbsp;Prev Post</a>
<a href="https://deep110.github.io/posts/blogs/2021-01-09-understanding-digital-paint-colors.html">Next Post&nbsp;→</a>
</div>
<div>
<script src="https://utteranc.es/client.js" repo="deep110/deep110.github.io" issue-term="pathname" label="comment" theme="github-light" crossorigin="anonymous" async></script>
</div>
</article>
</div>
</div>
<footer class="site-footer">
<div class="wrapper">
<a class="footer-icon icon" href="https://github.com/deep110" aria-label="Github">
<svg viewBox="0 0 438.55 438.55">
<path d="m409.13 114.57c-19.608-33.596-46.205-60.194-79.798-79.8-33.598-19.607-70.277-29.408-110.06-29.408-39.781 0-76.472 9.804-110.06 29.408-33.596 19.605-60.192 46.204-79.8 79.8-19.605 33.595-29.408 70.281-29.408 110.06 0 47.78 13.94 90.745 41.827 128.91 27.884 38.164 63.906 64.572 108.06 79.227 5.14.954 8.945.283 11.419-1.996 2.475-2.282 3.711-5.14 3.711-8.562 0-.571-.049-5.708-.144-15.417-.098-9.709-.144-18.179-.144-25.406l-6.567 1.136c-4.187.767-9.469 1.092-15.846 1-6.374-.089-12.991-.757-19.842-1.999-6.854-1.231-13.229-4.086-19.13-8.559-5.898-4.473-10.085-10.328-12.56-17.556l-2.855-6.57c-1.903-4.374-4.899-9.233-8.992-14.559-4.093-5.331-8.232-8.945-12.419-10.848l-1.999-1.431c-1.332-.951-2.568-2.098-3.711-3.429-1.142-1.331-1.997-2.663-2.568-3.997-.572-1.335-.098-2.43 1.427-3.289s4.281-1.276 8.28-1.276l5.708.853c3.807.763 8.516 3.042 14.133 6.851 5.614 3.806 10.229 8.754 13.846 14.842 4.38 7.806 9.657 13.754 15.846 17.847 6.184 4.093 12.419 6.136 18.699 6.136s11.704-.476 16.274-1.423c4.565-.952 8.848-2.383 12.847-4.285 1.713-12.758 6.377-22.559 13.988-29.41-10.848-1.14-20.601-2.857-29.264-5.14-8.658-2.286-17.605-5.996-26.835-11.14-9.235-5.137-16.896-11.516-22.985-19.126-6.09-7.614-11.088-17.61-14.987-29.979-3.901-12.374-5.852-26.648-5.852-42.826 0-23.035 7.52-42.637 22.557-58.817-7.044-17.318-6.379-36.732 1.997-58.24 5.52-1.715 13.706-.428 24.554 3.853 10.85 4.283 18.794 7.952 23.84 10.994 5.046 3.041 9.089 5.618 12.135 7.708 17.705-4.947 35.976-7.421 54.818-7.421s37.117 2.474 54.823 7.421l10.849-6.849c7.419-4.57 16.18-8.758 26.262-12.565 10.088-3.805 17.802-4.853 23.134-3.138 8.562 21.509 9.325 40.922 2.279 58.24 15.036 16.18 22.559 35.787 22.559 58.817 0 16.178-1.958 30.497-5.853 42.966-3.9 12.471-8.941 22.457-15.125 29.979-6.191 7.521-13.901 13.85-23.131 18.986-9.232 5.14-18.182 8.85-26.84 11.136-8.662 2.286-18.415 4.004-29.263 5.146 9.894 8.562 14.842 22.077 14.842 40.539v60.237c0 3.422 1.19 6.279 3.572 8.562 2.379 2.279 6.136 2.95 11.276 1.995 44.163-14.653 80.185-41.062 108.07-79.226 27.88-38.161 41.825-81.126 41.825-128.91-.01-39.771-9.818-76.454-29.414-110.05z"/>
</svg>
</a>
<a class="footer-icon icon" href="https://www.linkedin.com/in/deepankar-agrawal-318aab96/" aria-label="LinkedIn">
<svg enable-background="new 0 0 486.392 486.392" version="1.1" viewBox="0 0 486.39 486.39">
<path d="m243.2 0c-134.3 0-243.2 108.89-243.2 243.2s108.89 243.2 243.2 243.2 243.2-108.89 243.2-243.2c0-134.34-108.89-243.2-243.2-243.2zm-60.799 360.99h-60.799v-212.8h60.799v212.8zm-28.515-225.84c-15.747 0-28.484-12.768-28.484-28.515s12.768-28.515 28.484-28.515c15.747 0.03 28.515 12.798 28.515 28.515 0 15.747-12.768 28.515-28.515 28.515zm241.31 225.84h-60.799v-131.57c0-15.413-4.408-26.204-23.347-26.204-31.403 0-37.452 26.204-37.452 26.204v131.57h-60.799v-212.8h60.799v20.337c8.694-6.657 30.399-20.307 60.799-20.307 19.699 0 60.799 11.795 60.799 83.051v129.72z"/>
</svg>
</a>
<a class="footer-icon icon" href="https://deep110.github.io/rss.xml" aria-label="RSS">
<svg viewBox="0 0 48 48">
<path fill-rule="evenodd" clip-rule="evenodd" d="M24 0C10.7452 0 0 10.7452 0 24C0 37.2548 10.7452 48 24 48C37.2548 48 48 37.2548 48 24C48 10.7452 37.2548 0 24 0ZM17.6002 33.6C15.833 33.6 14.4002 32.1672 14.4002 30.4C14.4002 28.6328 15.833 27.2 17.6002 27.2C19.3674 27.2 20.8002 28.6328 20.8002 30.4C20.8002 32.1672 19.3674 33.6 17.6002 33.6ZM36.8 33.6C36.8 21.2488 26.7513 11.2 14.4002 11.2V15.4664C24.3993 15.4664 32.5336 23.6008 32.5336 33.6H36.8ZM14.4 18.6664C22.6343 18.6664 29.3334 25.3656 29.3334 33.6H25.0671C25.0671 27.7184 20.2815 22.9336 14.4 22.9336V18.6664Z"/>
</svg>
</a>
<a class="footer-icon icon" href="mailto:deepankar11093@gmail.com" aria-label="Mail">
<svg enable-background="new 0 0 299.997 299.997" viewBox="0 0 299.997 299.997"><path d="m149.996 0c-82.839 0-149.995 67.158-149.995 149.997 0 82.837 67.156 150 149.995 150s150-67.163 150-150c0-82.839-67.161-149.997-150-149.997zm.003 52.686 88.763 55.35h-177.526zm89.869 143.737h-.009c0 8.878-7.195 16.072-16.072 16.072h-147.576c-8.878 0-16.072-7.195-16.072-16.072v-84.865c0-.939.096-1.852.252-2.749l84.808 52.883c.104.065.215.109.322.169.112.062.226.122.34.179.599.309 1.216.558 1.847.721.065.018.13.026.195.041.692.163 1.393.265 2.093.265h.005.01c.7 0 1.401-.099 2.093-.265.065-.016.13-.023.195-.041.63-.163 1.245-.412 1.847-.721.114-.057.228-.117.34-.179.106-.06.218-.104.322-.169l84.808-52.883c.156.897.252 1.808.252 2.749z"/></svg>
</a>
</div>
</footer>
<script type="text/javascript" src="https://deep110.github.io/assets/js/base.js"></script>
</body>
</html>